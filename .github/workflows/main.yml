name: Node.js Windows Agent Pipeline

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: 

jobs:
  build:
    name: Build on Local Windows Agent
    # Targets your specific self-hosted runner labels
    runs-on: [self-hosted, Windows, X64] 

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Install and Build
        shell: powershell
        run: |
          # Dynamically locate package.json to avoid path errors
          $packageFile = Get-ChildItem -Recurse -Filter "package.json" | Select-Object -First 1
          
          if ($packageFile) {
              $projectDir = $packageFile.DirectoryName
              Write-Host "Success: Found project at $projectDir"
              
              # Navigate to the project folder
              cd $projectDir
              
              # Install dependencies
              Write-Host "Running npm install..."
              npm install
              
              # Execute build if the script is defined in package.json
              Write-Host "Running build..."
              npm run build --if-present
          } else {
              Write-Error "Build Failed: package.json not found in the repository."
              exit 1
          }
